apply plugin: 'com.android.application'

def getVersionName = { ->
	def stdout = new ByteArrayOutputStream()
	exec {
		workingDir '../'
		commandLine 'git', 'rev-list', '-n', '1', 'HEAD'
		standardOutput = stdout
	}
	return 'git-' + stdout.toString().trim()
}

def getVersionCode = { ->
	def stdout = new ByteArrayOutputStream()
	exec {
		workingDir '../'
		commandLine 'git', 'rev-list', '--count', 'HEAD'
		standardOutput = stdout
	}
	return + stdout.toString().trim().toInteger()
}

android {
	compileSdkVersion = 29
	ndkVersion '22.1.7171670'

	defaultConfig {
		applicationId 'su.xash.tf15client'
		versionName getVersionName()
		versionCode getVersionCode()
		minSdkVersion 14
		targetSdkVersion 29

		externalNativeBuild {
			ndkBuild {
				arguments "V=1"
			}
		}
	}
	
	compileOptions {
		sourceCompatibility JavaVersion.VERSION_1_8
		targetCompatibility JavaVersion.VERSION_1_8
	}

	buildTypes {
		debug {
			minifyEnabled false
			proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
		}
		release {
			minifyEnabled false
			proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
		}
	}

	externalNativeBuild {
		cmake {
			path file('../../CMakeLists.txt')
		}
	}

	lintOptions {
		abortOnError false
	}
}

dependencies {
	implementation 'androidx.activity:activity:1.2.2'
	implementation 'androidx.appcompat:appcompat:1.2.0'
	implementation 'androidx.fragment:fragment:1.3.2'
	implementation 'com.google.android.material:material:1.3.0'
	implementation 'com.android.volley:volley:1.2.0'
}

task makePak(type:Exec) {
	commandLine 'python', 'makepak.py', 'pak/', 'src/main/assets/extras.pak'
}

task getCommitHash(type:Exec) {
	commandLine
}

preBuild.dependsOn(makePak)